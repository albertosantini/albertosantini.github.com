---
layout: post
name: xirr
title: XIRR
time: 2008-01-28 19:58:00.000000000 +01:00
---
Internal Rate of Return using R programming language<br /><br /><span style="font-family:courier new;font-size:75%;"><br /><code><pre><br />#~ Title: XIRR Excel function simulation<br />#~ <br />#~ Reference 1: How to manage irregular intervals - http://www.geocities.com/accessreddy/excel/xirr.htm<br />#~ Reference 2: How to calculate IRR manually - http://www.s-anand.net/Calculating_IRR_manually.html<br />#~ <br />#~ Step 1: enter zeroes (0) against dates that do not have any cash outflow or inflows.<br />#~ Step 1bis: calculate IRR for these cash flow values using normal IRR function.<br />#~ Step 1tris: or using an iteractive approach as bisection method to find the NPV zeroes.<br />#~ Step 2: multiply this value of IRR by 365 to get annual IRR (since, these are daily cash flows).<br />#~ Step 3: refine using the formula =( 1+ R / 365) ^ 365 - 1), where R is the the value obtained in Step2.<br />#~<br /><br /># <br />sppv <- function (i, n) {<br />  return((1 + i/100)^(-n))<br />}<br /><br /># Net Present Value<br />npv <- function(x, i) {<br />  npv = c()<br />  for (k in 1:length(i)) {<br />    pvs = x * sppv(i[k], 1:length(x))<br />    npv = c(npv, sum(pvs))<br />  }<br />  return(npv)<br />}<br /><br /># Internal rate of return for non-periodic cash flow<br /># Input: cashflow - vector of numeric<br />#           dates - vector of strings containing dates with this format "%d-%m-%y"<br /># Output: irr - internal rate of return - range 0,1<br />#<br />xirr <- function (cashflow, dates) {<br />  if (length(cashflow) != length(dates)) {<br />    stop("length(cashflow) != length(dates)")<br />  }<br /><br />  cashflow_adj <- c(cashflow[1])<br />  for (i in 1:(length(cashflow)-1)) {<br />    d1 <- as.Date(dates[i], "%d-%m-%y")<br />    d2 <- as.Date(dates[i+1], "%d-%m-%y")<br />    # There are no checks about the monotone values of dates<br />    interval <- as.integer(d2 - d1)<br />    cashflow_adj <- c(cashflow_adj, rep(0, interval-1), cashflow[i+1])<br />  }<br /><br />  # Bisection method finding the rate to zero npv<br />  left = -10<br />  right = 10<br />  epsilon = 1e-8<br />  while (abs(right-left) > 2*epsilon) {<br />    midpoint = (right+left)/2<br />    if (npv(cashflow_adj, left) * npv(cashflow_adj, midpoint) > 0) {<br />      left = midpoint<br />    } else {<br />      right = midpoint<br />    }<br />  }<br /><br />  # Irr for daily cashflow (not in percentage format)<br />  irr = (right+left) / 2 / 100  <br />  # Irr for daily cashflow multiplied by 365 to get yearly return<br />  irr <- irr * 365 <br />  # Annualized yield (return) reflecting compounding effect of daily returns<br />  irr <- (1 + irr / 365) ^ 365 - 1<br />  <br />  irr<br />}<br /><br />#~ npv(rep(8792,12), 666.31/12) # 15755.01 - 100000 - 10.0088%<br /><br /># the correct IRR is 10.06% - source: matlab example<br />mycashflow <- c(-10000,2500, 2000, 3000,4000)<br />mydates <- c("12-01-87", "14-02-88", "03-03-88", "14-06-88", "01-12-88")<br />xirr(mycashflow, mydates)<br /><br /># the correct IRR is 37.34% - source: microsoft example<br />mycashflow <- c(-10000,2750,4250,3250,2750)<br />mydates <- c("1-01-08","1-03-08","30-10-08","15-02-09","1-04-09")<br />xirr(mycashflow, mydates)<br /></code></pre><br /></span>
