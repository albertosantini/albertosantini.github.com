<!DOCTYPE html>

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Team4545 Scheduled Games</title>

<style>
    body { font-family: courier, arial, serif; font-size: 10pt; }

    .division { display: inline-block; width: 119px; }
    .round { display: inline-block; width: 20px; }
    .when { display: inline-block; width: 170px; font-weight: bold; }
    .whenLocal { display: inline-block; width: 170px; color: blue; }
    .whiteTeam { display: inline-block; width: 195px; }
    .whitePlayer { display: inline-block; width: 119px; }
    .blackPlayer { display: inline-block; width: 119px; }
    .blackTeam { display: inline-block; width: 195px; }
    .board { display: inline-block; width: 21px; }

    .highlight { color: red; }
</style>
</head>

<body>
	<h1>Team4545 Scheduled Games - RedDeMate Family</h1>

	<div id="games">
	</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js">
</script>

<script type="text/javascript">
/*jslint unparam:true */
/*global jQuery */

jQuery(document).ready(function () {
    var path = "http://team4545league.org/tournament/games.html";

    function formatDate(date) {
       var edtNY = { // EDT periods for NY, otherwise EST, (Mar - Nov)
                2011: { "start": "031302:00", "end": "110602:00"},
                2012: { "start": "031102:00", "end": "110402:00"},
                2013: { "start": "031002:00", "end": "110302:00"},
                2014: { "start": "030902:00", "end": "110202:00"},
                2015: { "start": "030802:00", "end": "110102:00"},
                2016: { "start": "031302:00", "end": "110602:00"},
                2017: { "start": "031202:00", "end": "110502:00"},
                2018: { "start": "031102:00", "end": "110402:00"},
                2019: { "start": "031002:00", "end": "110302:00"}
            },
            months = {
                "Jan": "01",
                0: "Jan",
                "Feb": "02",
                1: "Feb",
                "Mar": "03",
                2: "Mar",
                "Apr": "04",
                3: "Apr",
                "May": "05",
                4: "May",
                "Jun": "06",
                5: "Jun",
                "Jul": "07",
                6: "Jul",
                "Aug": "08",
                7: "Aug",
                "Sep": "09",
                8: "Sep",
                "Oct": "10",
                9: "Oct",
                "Nov": "11",
                10: "Nov",
                "Dec": "12",
                11: "Dec"
            },
            days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            now = new Date(),
            ld, sp, mmmddd, mdh, yyyy, www, mmm, ddd, hhh, dd, hh, mm, tz;

        yyyy = now.getFullYear();
        sp = date.split(", ");
        www = sp[0];
        hhh = sp[2];
        mmmddd = sp[1].split(" ");
        mmm = mmmddd[0];
        ddd = mmmddd[1];

        mdh = months[mmm] + ddd + hhh;
        if (mdh >= edtNY[yyyy].start && mdh < edtNY[yyyy].end) {
            tz = "EDT";
        } else {
            tz = "EST";
        }

        ld = new Date(www + ", " + ddd + " " + mmm + " " + yyyy + 
            " " + hhh + ":00 " + tz);

        dd = ld.getDate();
        dd = dd < 10 ? "0" + dd : dd;
        hh = ld.getHours();
        hh = hh < 10 ? "0" + hh : hh;
        mm = ld.getMinutes();
        mm = mm < 10 ? "0" + mm : mm;

        return days[ld.getDay()] + ", " + months[ld.getMonth()] + " " + dd +
            ", " + hh + ":" + mm;
    }

    function requestCrossDomain(site, callback) {
        var yql = 'http://query.yahooapis.com/v1/public/yql?q=' +
            encodeURIComponent('select * from html where url="' + site + '"') +
            '&format=xml&callback=?';

        site = site || "http://www.google.com";

        function cbFunc(data) {
            if (data.results[0]) {
                data = data.results[0];

                if (typeof callback === 'function') {
                    callback(data);
                }
            } else {
                throw new Error('Nothing returned from getJSON.');
            }
        }

        jQuery.getJSON(yql, cbFunc);
    }

    function myContainer(results) {
        var teamName = 'RedDeMate', container, found= false;

        container = "<span class='when'>" + "When ICC" + "<\/span>" +
            "<span class='whenLocal'>" + "When Local" + "<\/span>" +
            "<span class='division'>" + "Division" + "<\/span>" +
            "<span class='round'>" + "R" + "<\/span>" +
            "<span class='whiteTeam'>" + "White Team" + "<\/span>" +
            "<span class='whitePlayer'>" + "White Player" + "<\/span>" +
            "<span class='blackPlayer'>" + "Black Player" + "<\/span>" +
            "<span class='blackTeam'>" + "Black Team" + "<\/span>" +
            "<span class='board'>" + "B" + "<\/span>" + "<br /><br />";

        jQuery("tr:contains('" + teamName + "')", results)
            .each(function (index, el) {
                var cols = jQuery("td p", el), 
                    division,
                    round,
                    when,
                    whenLocal,
                    whiteTeam,
                    whitePlayer,
                    blackPlayer,
                    blackTeam,
                    board;

                found = true;

                division = jQuery(cols[0]).text().replace(/\s{2,}/g, ' ');
                round = cols[1].innerHTML;
                when = cols[2].innerHTML;
                whenLocal = formatDate(when);
                whiteTeam = cols[3].innerHTML;
                whitePlayer = cols[4].innerHTML;
                if (cols.length === 9) {
                    blackPlayer = cols[6].innerHTML;
                    blackTeam = cols[7].innerHTML;
                    board = cols[8].innerHTML;
                } else {
                    blackPlayer = cols[5].innerHTML;
                    blackTeam = cols[6].innerHTML;
                    board = cols[7].innerHTML;
                }

                container += "<span class='when'>" + when + "<\/span>" +
                    "<span class='whenLocal'>" + whenLocal + "<\/span>" +
                    "<span class='division'>" + division + "<\/span>" +
                    "<span class='round'>" + round + "<\/span>" +
                    "<span class='whiteTeam'>" + whiteTeam + "<\/span>";
                if (whiteTeam.search(teamName) !== -1) {
                    container += "<span class='whitePlayer highlight'>" + 
                        whitePlayer + "<\/span>";
                } else {
                    container += "<span class='whitePlayer'>" +
                        whitePlayer + "<\/span>";
                }
                if (blackTeam.search(teamName) !== -1) {
                    container += "<span class='blackPlayer highlight'>" + 
                        blackPlayer + "<\/span>";
                } else {
                    container += "<span class='blackPlayer'>" + 
                        blackPlayer + "<\/span>";
                }
                container += "<span class='blackTeam'>" + 
                    blackTeam + "<\/span>" +
                    "<span class='board'>" + 
                    board + "<\/span>" + "<br />";
            });

        if (found) {
            jQuery('#games').html(container);
        } else {
            jQuery('#games').html("Games not scheduled yet.");
        }
    }

    requestCrossDomain(path, myContainer);
});

</script>
</body>
</html>


